<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Microservices Testing UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .service-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-5px);
        }

        .service-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .service-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .service-port {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-info {
            background: #3b82f6;
            color: white;
        }

        .response-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .response-header {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        pre {
            background: #2d3748;
            color: #a0aec0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
        }

        .status-success {
            color: #10b981;
            font-weight: bold;
        }

        .status-error {
            color: #ef4444;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: #e0e0e0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .quick-actions {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .quick-actions h2 {
            margin-bottom: 15px;
            color: #333;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>🚀 E-Commerce Microservices Testing UI</h1>
        <p>Test and interact with your microservices architecture</p>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>⚡ Quick Actions</h2>
        <div class="action-buttons">
            <button class="btn-success" onclick="testConnection()">Test All Services</button>
            <button class="btn-info" onclick="createTestData()">Create Test Data</button>
            <button class="btn-warning" onclick="simulateOrderFlow()">Simulate Order Flow</button>
            <button class="btn-primary" onclick="clearAllResponses()">Clear All Responses</button>
        </div>
    </div>

    <!-- Services Grid -->
    <div class="services-grid">
        <!-- Product Service -->
        <div class="service-card">
            <div class="service-header">
                <div class="service-title">📦 Product Service</div>
                <div class="service-port">:8083</div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('product', 0)">Create</button>
                <button class="tab" onclick="switchTab('product', 1)">Get</button>
                <button class="tab" onclick="switchTab('product', 2)">Search</button>
            </div>

            <!-- Create Product -->
            <div class="tab-content active" id="product-tab-0">
                <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="productId" placeholder="LAPTOP001" value="LAPTOP001">
                </div>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="productName" placeholder="Gaming Laptop" value="Gaming Laptop Pro">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" id="productCategory" placeholder="Electronics" value="Electronics">
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input type="number" id="productPrice" placeholder="999.99" value="1299.99" step="0.01">
                </div>
                <div class="form-group">
                    <label>Brand</label>
                    <input type="text" id="productBrand" placeholder="TechBrand" value="TechBrand">
                </div>
                <button class="btn-primary" onclick="createProduct()">Create Product</button>
            </div>

            <!-- Get Product -->
            <div class="tab-content" id="product-tab-1">
                <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="getProductId" placeholder="LAPTOP001">
                </div>
                <div class="button-group">
                    <button class="btn-info" onclick="getProduct()">Get Product</button>
                    <button class="btn-info" onclick="getAllProducts()">Get All</button>
                </div>
            </div>

            <!-- Search Product -->
            <div class="tab-content" id="product-tab-2">
                <div class="form-group">
                    <label>Search Query</label>
                    <input type="text" id="searchQuery" placeholder="laptop">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" id="searchCategory" placeholder="Electronics">
                </div>
                <button class="btn-info" onclick="searchProducts()">Search</button>
            </div>

            <div class="response-container" id="product-response"></div>
        </div>

        <!-- Inventory Service -->
        <div class="service-card">
            <div class="service-header">
                <div class="service-title">📊 Inventory Service</div>
                <div class="service-port">:8082</div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('inventory', 0)">Create</button>
                <button class="tab" onclick="switchTab('inventory', 1)">Manage</button>
                <button class="tab" onclick="switchTab('inventory', 2)">Check</button>
            </div>

            <!-- Create Inventory -->
            <div class="tab-content active" id="inventory-tab-0">
                <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="invProductId" placeholder="LAPTOP001" value="LAPTOP001">
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" id="invQuantity" placeholder="100" value="100">
                </div>
                <button class="btn-primary" onclick="createInventory()">Create Inventory</button>
            </div>

            <!-- Manage Inventory -->
            <div class="tab-content" id="inventory-tab-1">
                <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="manageProductId" placeholder="LAPTOP001">
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" id="manageQuantity" placeholder="10" value="10">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="addStock()">Add Stock</button>
                    <button class="btn-warning" onclick="reserveInventory()">Reserve</button>
                    <button class="btn-danger" onclick="releaseInventory()">Release</button>
                </div>
            </div>

            <!-- Check Inventory -->
            <div class="tab-content" id="inventory-tab-2">
                <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="checkProductId" placeholder="LAPTOP001">
                </div>
                <div class="button-group">
                    <button class="btn-info" onclick="getInventory()">Get Inventory</button>
                    <button class="btn-info" onclick="getAvailable()">Get Available</button>
                </div>
            </div>

            <div class="response-container" id="inventory-response"></div>
        </div>

        <!-- Order Service -->
        <div class="service-card">
            <div class="service-header">
                <div class="service-title">🛒 Order Service</div>
                <div class="service-port">:8081</div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('order', 0)">Create</button>
                <button class="tab" onclick="switchTab('order', 1)">Manage</button>
                <button class="tab" onclick="switchTab('order', 2)">Search</button>
            </div>

            <!-- Create Order -->
            <div class="tab-content active" id="order-tab-0">
                <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="orderProductId" placeholder="LAPTOP001" value="LAPTOP001">
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" id="orderQuantity" placeholder="5" value="5">
                </div>
                <button class="btn-primary" onclick="createOrder()">Create Order</button>
            </div>

            <!-- Manage Order -->
            <div class="tab-content" id="order-tab-1">
                <div class="form-group">
                    <label>Order ID</label>
                    <input type="number" id="manageOrderId" placeholder="1">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="orderStatus">
                        <option value="PENDING">PENDING</option>
                        <option value="CONFIRMED">CONFIRMED</option>
                        <option value="SHIPPED">SHIPPED</option>
                        <option value="COMPLETED">COMPLETED</option>
                        <option value="CANCELLED">CANCELLED</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn-info" onclick="getOrder()">Get Order</button>
                    <button class="btn-warning" onclick="updateOrderStatus()">Update Status</button>
                    <button class="btn-danger" onclick="deleteOrder()">Delete</button>
                </div>
            </div>

            <!-- Search Order -->
            <div class="tab-content" id="order-tab-2">
                <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="searchOrderProductId" placeholder="LAPTOP001">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="searchOrderStatus">
                        <option value="">All</option>
                        <option value="PENDING">PENDING</option>
                        <option value="CONFIRMED">CONFIRMED</option>
                        <option value="SHIPPED">SHIPPED</option>
                        <option value="COMPLETED">COMPLETED</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn-info" onclick="searchOrders()">Search Orders</button>
                    <button class="btn-info" onclick="getAllOrders()">Get All</button>
                </div>
            </div>

            <div class="response-container" id="order-response"></div>
        </div>
    </div>

    <div class="footer">
        <p>💡 Tip: Check the browser console for detailed logs</p>
        <p>Made with ❤️ for testing microservices architecture</p>
    </div>
</div>

<script>
    const API_BASE_URLS = {
        product: 'http://localhost:8083/api/products',
        inventory: 'http://localhost:8082/api/inventory',
        order: 'http://localhost:8081/api/orders'
    };

    // Enable CORS for development
    const headers = {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
    };

    function switchTab(service, tabIndex) {
        // Get all tabs and buttons for this service
        const tabsContainer = document.querySelector(`#${service}-tab-0`).parentElement;
        const tabs = tabsContainer.querySelectorAll('.tab-content');
        const buttonsContainer = tabsContainer.previousElementSibling;
        const buttons = buttonsContainer.querySelectorAll('.tab');

        // Remove active class from all tabs and buttons
        tabs.forEach(tab => tab.classList.remove('active'));
        buttons.forEach(btn => btn.classList.remove('active'));

        // Add active class to selected tab and button
        tabs[tabIndex].classList.add('active');
        buttons[tabIndex].classList.add('active');

        console.log(`Switched to ${service} tab ${tabIndex}`);
    }

    async function makeRequest(service, method, endpoint, body = null) {
        const responseDiv = document.getElementById(`${service}-response`);
        responseDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading...</p></div>';

        try {
            const options = {
                method,
                headers: headers,
                mode: 'cors' // Enable CORS
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            const url = `${API_BASE_URLS[service]}${endpoint}`;
            console.log(`📤 ${method} ${url}`, body || '');

            const response = await fetch(url, options);

            // Handle empty responses (like DELETE)
            let data;
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                data = await response.json();
            } else if (response.status === 204) {
                data = { message: 'Operation completed successfully' };
            } else {
                const text = await response.text();
                data = text ? { response: text } : { message: 'Success' };
            }

            console.log(`📥 Response [${response.status}]:`, data);
            displayResponse(service, response.status, data);
            return data;
        } catch (error) {
            console.error('❌ Request failed:', error);
            displayResponse(service, 'ERROR', {
                error: error.message,
                tip: 'Make sure the service is running and CORS is enabled'
            });
        }
    }

    function displayResponse(service, status, data) {
        const responseDiv = document.getElementById(`${service}-response`);
        const statusClass = status >= 200 && status < 300 ? 'status-success' : 'status-error';

        responseDiv.innerHTML = `
                <div class="response-header">
                    Response <span class="${statusClass}">[${status}]</span>
                </div>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
    }

    // Product Service Functions
    async function createProduct() {
        const body = {
            productId: document.getElementById('productId').value,
            name: document.getElementById('productName').value,
            category: document.getElementById('productCategory').value,
            price: parseFloat(document.getElementById('productPrice').value),
            brand: document.getElementById('productBrand').value,
            description: "High-performance product with excellent features",
            active: true
        };

        if (!body.productId || !body.name || !body.category || !body.price) {
            alert('Please fill in all required fields');
            return;
        }

        await makeRequest('product', 'POST', '', body);
    }

    async function getProduct() {
        const productId = document.getElementById('getProductId').value;
        if (!productId) {
            alert('Please enter a Product ID');
            return;
        }
        // Try by productId first, if your endpoint supports it
        await makeRequest('product', 'GET', `/code/${productId}`);
    }

    async function getAllProducts() {
        await makeRequest('product', 'GET', '');
    }

    async function searchProducts() {
        const query = document.getElementById('searchQuery').value;
        const category = document.getElementById('searchCategory').value;

        if (!query && !category) {
            alert('Please enter a search query or category');
            return;
        }

        let endpoint = '/search?';
        if (category) endpoint += `category=${category}&`;
        if (query) endpoint += `query=${query}`;
        await makeRequest('product', 'GET', endpoint);
    }

    // Inventory Service Functions
    async function createInventory() {
        const body = {
            productId: document.getElementById('invProductId').value,
            quantity: parseInt(document.getElementById('invQuantity').value),
            reservedQuantity: 0
        };

        if (!body.productId || !body.quantity) {
            alert('Please fill in all required fields');
            return;
        }

        await makeRequest('inventory', 'POST', '', body);
    }

    async function getInventory() {
        const productId = document.getElementById('checkProductId').value;
        if (!productId) {
            alert('Please enter a Product ID');
            return;
        }
        await makeRequest('inventory', 'GET', `/${productId}`);
    }

    async function getAvailable() {
        const productId = document.getElementById('checkProductId').value;
        if (!productId) {
            alert('Please enter a Product ID');
            return;
        }
        await makeRequest('inventory', 'GET', `/${productId}/available`);
    }

    async function addStock() {
        const productId = document.getElementById('manageProductId').value;
        const quantity = document.getElementById('manageQuantity').value;

        if (!productId || !quantity) {
            alert('Please fill in all required fields');
            return;
        }

        await makeRequest('inventory', 'POST', `/${productId}/add?quantity=${quantity}`);
    }

    async function reserveInventory() {
        const productId = document.getElementById('manageProductId').value;
        const quantity = document.getElementById('manageQuantity').value;

        if (!productId || !quantity) {
            alert('Please fill in all required fields');
            return;
        }

        await makeRequest('inventory', 'POST', `/${productId}/reserve?quantity=${quantity}`);
    }

    async function releaseInventory() {
        const productId = document.getElementById('manageProductId').value;
        const quantity = document.getElementById('manageQuantity').value;

        if (!productId || !quantity) {
            alert('Please fill in all required fields');
            return;
        }

        await makeRequest('inventory', 'POST', `/${productId}/release?quantity=${quantity}`);
    }

    // Order Service Functions
    async function createOrder() {
        const body = {
            productId: document.getElementById('orderProductId').value,
            quantity: parseInt(document.getElementById('orderQuantity').value)
        };

        if (!body.productId || !body.quantity) {
            alert('Please fill in all required fields');
            return;
        }

        await makeRequest('order', 'POST', '', body);
    }

    async function getOrder() {
        const orderId = document.getElementById('manageOrderId').value;
        if (!orderId) {
            alert('Please enter an Order ID');
            return;
        }
        await makeRequest('order', 'GET', `/${orderId}`);
    }

    async function getAllOrders() {
        await makeRequest('order', 'GET', '');
    }

    async function updateOrderStatus() {
        const orderId = document.getElementById('manageOrderId').value;
        const status = document.getElementById('orderStatus').value;

        if (!orderId) {
            alert('Please enter an Order ID');
            return;
        }

        await makeRequest('order', 'PUT', `/${orderId}/status?status=${status}`);
    }

    async function deleteOrder() {
        const orderId = document.getElementById('manageOrderId').value;

        if (!orderId) {
            alert('Please enter an Order ID');
            return;
        }

        if (confirm('Are you sure you want to delete this order?')) {
            await makeRequest('order', 'DELETE', `/${orderId}`);
        }
    }

    async function searchOrders() {
        const productId = document.getElementById('searchOrderProductId').value;
        const status = document.getElementById('searchOrderStatus').value;

        if (!productId && !status) {
            alert('Please enter a Product ID or select a Status');
            return;
        }

        let endpoint = '/search?';
        if (productId) endpoint += `productId=${productId}&`;
        if (status) endpoint += `status=${status}`;
        await makeRequest('order', 'GET', endpoint);
    }

    // Quick Actions
    async function testConnection() {
        console.log('🔍 Testing all services...');
        let results = [];

        // Test Product Service
        try {
            const response = await fetch(API_BASE_URLS.product, { mode: 'cors' });
            results.push('✅ Product Service (8083): Connected');
            console.log('✅ Product Service: OK');
        } catch (e) {
            results.push('❌ Product Service (8083): Not running or CORS issue');
            console.error('❌ Product Service:', e.message);
        }

        // Test Inventory Service
        try {
            const response = await fetch(API_BASE_URLS.inventory, { mode: 'cors' });
            results.push('✅ Inventory Service (8082): Connected');
            console.log('✅ Inventory Service: OK');
        } catch (e) {
            results.push('❌ Inventory Service (8082): Not running or CORS issue');
            console.error('❌ Inventory Service:', e.message);
        }

        // Test Order Service
        try {
            const response = await fetch(API_BASE_URLS.order, { mode: 'cors' });
            results.push('✅ Order Service (8081): Connected');
            console.log('✅ Order Service: OK');
        } catch (e) {
            results.push('❌ Order Service (8081): Not running or CORS issue');
            console.error('❌ Order Service:', e.message);
        }

        alert(results.join('\n\n'));
    }

    async function createTestData() {
        if (!confirm('This will create test product and inventory. Continue?')) return;

        console.log('🔨 Creating test data...');
        alert('Creating test data...');

        try {
            // Create Product
            await makeRequest('product', 'POST', '', {
                productId: 'TEST001',
                name: 'Test Product',
                category: 'Test Category',
                price: 99.99,
                brand: 'TestBrand',
                description: 'Test product for demonstration',
                active: true
            });

            // Wait a bit
            await new Promise(resolve => setTimeout(resolve, 1500));

            // Create Inventory
            await makeRequest('inventory', 'POST', '', {
                productId: 'TEST001',
                quantity: 50,
                reservedQuantity: 0
            });

            alert('✅ Test data created successfully!\n\nProduct: TEST001\nInventory: 50 units');
        } catch (error) {
            alert('❌ Error creating test data. Check console for details.');
            console.error('Test data creation failed:', error);
        }
    }

    async function simulateOrderFlow() {
        if (!confirm('This will create a product, inventory, and order. Continue?')) return;

        console.log('🚀 Starting order flow simulation...');
        alert('Starting order flow simulation...');

        try {
            // Step 1: Create Product
            console.log('Step 1: Creating product...');
            await makeRequest('product', 'POST', '', {
                productId: 'FLOW001',
                name: 'Flow Test Product',
                category: 'Demo',
                price: 199.99,
                brand: 'DemoBrand',
                description: 'Product for testing complete order flow',
                active: true
            });

            await new Promise(resolve => setTimeout(resolve, 1500));

            // Step 2: Create Inventory
            console.log('Step 2: Creating inventory...');
            await makeRequest('inventory', 'POST', '', {
                productId: 'FLOW001',
                quantity: 100,
                reservedQuantity: 0
            });

            await new Promise(resolve => setTimeout(resolve, 1500));

            // Step 3: Create Order
            console.log('Step 3: Creating order...');
            await makeRequest('order', 'POST', '', {
                productId: 'FLOW001',
                quantity: 5
            });

            alert('✅ Order flow completed!\n\n' +
                '1. Product created (FLOW001)\n' +
                '2. Inventory created (100 units)\n' +
                '3. Order placed (5 units)\n\n' +
                'Check RabbitMQ and service logs!');
        } catch (error) {
            alert('❌ Order flow failed. Check console for details.');
            console.error('Order flow simulation failed:', error);
        }
    }

    function clearAllResponses() {
        document.getElementById('product-response').innerHTML = '<p style="color: #999;">No requests yet</p>';
        document.getElementById('inventory-response').innerHTML = '<p style="color: #999;">No requests yet</p>';
        document.getElementById('order-response').innerHTML = '<p style="color: #999;">No requests yet</p>';
        console.clear();
        console.log('🧹 All responses cleared');
    }

    // Welcome message
    console.log('%c🚀 E-Commerce Microservices Testing UI', 'font-size: 20px; color: #667eea; font-weight: bold;');
    console.log('%cAll API calls will be logged here', 'color: #666;');
</script>
</body>
</html>